<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ZVP-based reverse-engineering &#8212; pyecsca 0.3.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d10597a4" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=bf281230" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=de02a091" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" />
    <script src="../../_static/documentation_options.js?v=71d9d8e6"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../../_static/logo_black.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="EPA-based reverse engineering" href="epa.html" />
    <link rel="prev" title="RPA-based reverse-engineering" href="rpa.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo_black.png" alt="Logo" />
    
    <h1 class="logo logo-name">pyecsca</h1>
    
  </a>
</p>










<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html"><span class="fas fa-screwdriver-wrench fa-fw"></span> Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../notebooks.html"><span class="fas fa-hand-pointer fa-fw"></span> Notebooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../configuration_space.html">Configuration space</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulation.html">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codegen.html">Code generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../emulator.html">Emulation and leakage simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../measurement.html">Measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smartcards.html">Smartcards</a></li>
<li class="toctree-l2"><a class="reference internal" href="formulas.html">Exploration of formulas in open-source ECC libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpa.html">RPA-based reverse-engineering</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ZVP-based reverse-engineering</a></li>
<li class="toctree-l2"><a class="reference internal" href="epa.html">EPA-based reverse engineering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html"><span class="fas fa-code fa-fw"></span> API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries.html"><span class="fas fa-server fa-fw"></span> ECC in Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html"><span class="fas fa-asterisk fa-fw"></span> References</a></li>
</ul>

<ul style="margin-top: 1em">
    <li class="toctree-l1"><a href="https://github.com/J08nY/pyecsca/"><i class="fab fa-fw fa-github"></i> Source code</a></li>
    <li class="toctree-l1"><a href="https://pypi.org/project/pyecsca/"><i class="fas fa-fw fa-file"></i> Releases</a></li>
</ul><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../../notebooks.html"><span class="fas fa-hand-pointer fa-fw"></span> Notebooks</a><ul>
      <li>Previous: <a href="rpa.html" title="previous chapter">RPA-based reverse-engineering</a></li>
      <li>Next: <a href="epa.html" title="next chapter">EPA-based reverse engineering</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <a href="https://mybinder.org/v2/gh/J08nY/pyecsca-notebook/HEAD?labpath=re/zvp.ipynb" class="sd-badge sd-outline-primary">MyBinder</a><section id="ZVP-based-reverse-engineering">
<h1>ZVP-based reverse-engineering<a class="headerlink" href="#ZVP-based-reverse-engineering" title="Link to this heading">Â¶</a></h1>
<p>This notebook showcases the ZVP-based reverse-engineering technique for addition formulas.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#Exploration"><span class="std std-ref">Exploration</span></a></p></li>
<li><p><a class="reference internal" href="#Reverse-engineering"><span class="std std-ref">Reverse-engineering</span></a></p>
<ul>
<li><p><a class="reference internal" href="#Computing-addition-chains"><span class="std std-ref">Computing addition chains</span></a></p></li>
<li><p><a class="reference internal" href="#Loading-the-formulas"><span class="std std-ref">Loading the formulas</span></a></p></li>
<li><p><a class="reference internal" href="#Computing-the-factor-sets"><span class="std std-ref">Computing the factor sets</span></a></p></li>
<li><p><a class="reference internal" href="#Accumulating-polynomials"><span class="std std-ref">Accumulating polynomials</span></a></p></li>
<li><p><a class="reference internal" href="#Computing-ZVP-points"><span class="std std-ref">Computing ZVP points</span></a></p></li>
<li><p><a class="reference internal" href="#Remapping"><span class="std std-ref">Remapping</span></a></p></li>
<li><p><a class="reference internal" href="#Distinguishing-map-and-distinguishing-tree-building"><span class="std std-ref">Distinguishing map and distinguishing tree building</span></a></p></li>
<li><p><a class="reference internal" href="#Evaluation"><span class="std std-ref">Evaluation</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#Miscellaneous-analysis"><span class="std std-ref">Miscellaneous analysis</span></a></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">holoviews</span> <span class="k">as</span> <span class="nn">hv</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">tabulate</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">FF</span><span class="p">,</span> <span class="n">ZZ</span><span class="p">,</span> <span class="n">sympify</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">Poly</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span><span class="p">,</span> <span class="n">invalidate_caches</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span><span class="p">,</span> <span class="n">trange</span>
<span class="kn">from</span> <span class="nn">anytree</span> <span class="kn">import</span> <span class="n">RenderTree</span><span class="p">,</span> <span class="n">LevelOrderIter</span>


<span class="kn">from</span> <span class="nn">pyecsca.ec.model</span> <span class="kn">import</span> <span class="n">ShortWeierstrassModel</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.coordinates</span> <span class="kn">import</span> <span class="n">AffineCoordinateModel</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.curve</span> <span class="kn">import</span> <span class="n">EllipticCurve</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.params</span> <span class="kn">import</span> <span class="n">DomainParameters</span><span class="p">,</span> <span class="n">load_params_ecgen</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.formula</span> <span class="kn">import</span> <span class="n">FormulaAction</span><span class="p">,</span> <span class="n">AdditionFormula</span><span class="p">,</span> <span class="n">DoublingFormula</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.point</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.mod</span> <span class="kn">import</span> <span class="n">mod</span><span class="p">,</span> <span class="n">gcd</span><span class="p">,</span> <span class="n">SymbolicMod</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.context</span> <span class="kn">import</span> <span class="n">DefaultContext</span><span class="p">,</span> <span class="n">local</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.mult</span> <span class="kn">import</span> <span class="n">LTRMultiplier</span><span class="p">,</span> <span class="n">AccumulationOrder</span>
<span class="kn">from</span> <span class="nn">pyecsca.ec.error</span> <span class="kn">import</span> <span class="n">NonInvertibleError</span><span class="p">,</span> <span class="n">UnsatisfiedAssumptionError</span>
<span class="kn">from</span> <span class="nn">pyecsca.sca.re.tree</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">pyecsca.sca.re.rpa</span> <span class="kn">import</span> <span class="n">MultipleContext</span>
<span class="kn">from</span> <span class="nn">pyecsca.sca.re.zvp</span> <span class="kn">import</span> <span class="n">zvp_points</span><span class="p">,</span> <span class="n">compute_factor_set</span><span class="p">,</span> <span class="n">unroll_formula</span><span class="p">,</span>  <span class="n">addition_chain</span><span class="p">,</span> <span class="n">eliminate_y</span>
<span class="kn">from</span> <span class="nn">pyecsca.misc.cfg</span> <span class="kn">import</span> <span class="n">getconfig</span>
<span class="kn">from</span> <span class="nn">pyecsca.misc.utils</span> <span class="kn">import</span> <span class="n">TaskExecutor</span>

<span class="kn">from</span> <span class="nn">eval</span> <span class="kn">import</span> <span class="p">(</span><span class="n">eval_tree_symmetric1</span><span class="p">,</span> <span class="n">eval_tree_asymmetric1</span><span class="p">,</span> <span class="n">eval_tree_binomial1</span><span class="p">,</span>
                    <span class="n">success_rate_symmetric</span><span class="p">,</span> <span class="n">success_rate_asymmetric</span><span class="p">,</span> <span class="n">success_rate_binomial</span><span class="p">,</span>
                    <span class="n">query_rate_symmetric</span><span class="p">,</span> <span class="n">query_rate_asymmetric</span><span class="p">,</span> <span class="n">query_rate_binomial</span><span class="p">,</span>
                    <span class="n">amount_rate_symmetric</span><span class="p">,</span> <span class="n">amount_rate_asymmetric</span><span class="p">,</span> <span class="n">amount_rate_binomial</span><span class="p">,</span>
                    <span class="n">precise_rate_symmetric</span><span class="p">,</span> <span class="n">precise_rate_asymmetric</span><span class="p">,</span> <span class="n">precise_rate_binomial</span><span class="p">,</span>
                    <span class="n">success_rate_vs_majority_symmetric</span><span class="p">,</span> <span class="n">success_rate_vs_majority_asymmetric</span><span class="p">,</span>
                    <span class="n">success_rate_vs_query_rate_symmetric</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span>


<span class="c1"># Allow to use &quot;spawn&quot; multiprocessing method for function defined in a Jupyter notebook.</span>
<span class="c1"># https://neuromancer.sk/article/35</span>
<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">enable_spawn</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">invalidate_caches</span><span class="p">()</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">))</span>
        <span class="k">yield</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

<span class="n">spawn_context</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> ipympl
<span class="n">hv</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s2">&quot;bokeh&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ShortWeierstrassModel</span><span class="p">()</span>
<span class="n">coordsaff</span> <span class="o">=</span> <span class="n">AffineCoordinateModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Exploration">
<h2>Exploration<a class="headerlink" href="#Exploration" title="Link to this heading">Â¶</a></h2>
<p>First lets explore the behavior of addition formulas. The following two cells pick a coordinate model along with some formulas and symbolically unroll a scalar multiplication (assuming a simple LTR multiplier).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;jacobian&quot;</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">which</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">getconfig</span><span class="p">()</span><span class="o">.</span><span class="n">ec</span><span class="o">.</span><span class="n">mod_implementation</span> <span class="o">=</span> <span class="s2">&quot;symbolic&quot;</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;x y z&quot;</span><span class="p">)</span>

<span class="c1"># A 64-bit prime order curve for testing things out</span>
<span class="n">p</span> <span class="o">=</span> <span class="mh">0xc50de883f0e7b167</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">FF</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">SymbolicMod</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="mh">0x4833d7aa73fa6694</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">SymbolicMod</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="mh">0xa6c44a61c5323f6a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
<span class="n">gx</span> <span class="o">=</span> <span class="n">SymbolicMod</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="mh">0x5fd1f7d38d4f2333</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
<span class="n">gy</span> <span class="o">=</span> <span class="n">SymbolicMod</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="mh">0x21f43957d7e20ceb</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mh">0xc50de885003b80eb</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">infty</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">mod</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">Y</span><span class="o">=</span><span class="n">mod</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">Z</span><span class="o">=</span><span class="n">mod</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">gx</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">gy</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">mod</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

<span class="n">curve</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">infty</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">))</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">DomainParameters</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>


<span class="n">add</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">formulas</span><span class="p">[</span><span class="s2">&quot;add-2007-bl&quot;</span><span class="p">]</span>
<span class="n">dbl</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">formulas</span><span class="p">[</span><span class="s2">&quot;dbl-2007-bl&quot;</span><span class="p">]</span>
<span class="n">mult</span> <span class="o">=</span> <span class="n">LTRMultiplier</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">dbl</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">AccumulationOrder</span><span class="o">.</span><span class="n">PeqRP</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>


<span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span>
              <span class="n">X</span><span class="o">=</span><span class="n">SymbolicMod</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">),</span> <span class="n">params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">prime</span><span class="p">),</span>
              <span class="n">Y</span><span class="o">=</span><span class="n">SymbolicMod</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">),</span> <span class="n">params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">prime</span><span class="p">),</span>
              <span class="n">Z</span><span class="o">=</span><span class="n">SymbolicMod</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">),</span> <span class="n">params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">prime</span><span class="p">))</span>
<span class="n">mult</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">x_poly</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
<span class="n">y_poly</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
<span class="n">z_poly</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">x_poly</span><span class="p">,</span> <span class="n">y_poly</span><span class="p">,</span> <span class="n">z_poly</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The result is a Point with coordinates that are polynomials in the input coordinates and curve parameters. We now switch back to concrete representation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">getconfig</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">ec</span><span class="o">.</span><span class="n">mod_implementation</span> <span class="o">=</span> <span class="s2">&quot;gmp&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="Reverse-engineering">
<h2>Reverse-engineering<a class="headerlink" href="#Reverse-engineering" title="Link to this heading">Â¶</a></h2>
<p>Now, lets look at using the ZVP attack for reverse-engineering. First pick 10 curves per group, some random some with <span class="math notranslate nohighlight">\(a \in \{0, -1, -3 \}\)</span>. The curves are otherwise not special in any way and just serve to randomize the process, as the existence of ZVP points for a given intermediate value polynomial depends on the curve.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">curves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">spec</span><span class="p">:</span> <span class="n">load_params_ecgen</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="s2">&quot;affine&quot;</span><span class="p">),</span> <span class="p">[</span>
    <span class="c1"># Random</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xddf438409fc35161&quot;},&quot;a&quot;:&quot;0x94d919b72f7dc6d8&quot;,&quot;b&quot;:&quot;0x9f39032abb23f62a&quot;,&quot;order&quot;:&quot;0xddf4383ffa8e6de7&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0xd5673b3fe176fc6b&quot;,&quot;y&quot;:&quot;0x2d5b0a5bb2141317&quot;,&quot;order&quot;:&quot;0xddf4383ffa8e6de7&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0xd5673b3fe176fc6b&quot;,&quot;y&quot;:&quot;0x2d5b0a5bb2141317&quot;,&quot;order&quot;:&quot;0xddf4383ffa8e6de7&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xa42c1467a1ed04f3&quot;},&quot;a&quot;:&quot;0x55d07340a4572f2d&quot;,&quot;b&quot;:&quot;0x0a938c37dfb0b6d5&quot;,&quot;order&quot;:&quot;0xa42c14689284d3a7&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x8633981c83ed43a2&quot;,&quot;y&quot;:&quot;0x7b5374e9d7997199&quot;,&quot;order&quot;:&quot;0xa42c14689284d3a7&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x8633981c83ed43a2&quot;,&quot;y&quot;:&quot;0x7b5374e9d7997199&quot;,&quot;order&quot;:&quot;0xa42c14689284d3a7&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xea0d9cead19016ab&quot;},&quot;a&quot;:&quot;0xcbbfe501c4ef6d92&quot;,&quot;b&quot;:&quot;0x5762de777a6d9178&quot;,&quot;order&quot;:&quot;0xea0d9cea8cd2c857&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0xe7daa3e061c3111b&quot;,&quot;y&quot;:&quot;0x56ee59a6845c5e93&quot;,&quot;order&quot;:&quot;0xea0d9cea8cd2c857&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0xe7daa3e061c3111b&quot;,&quot;y&quot;:&quot;0x56ee59a6845c5e93&quot;,&quot;order&quot;:&quot;0xea0d9cea8cd2c857&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x9c7e7216decb71a7&quot;},&quot;a&quot;:&quot;0x324ef48887401a87&quot;,&quot;b&quot;:&quot;0x3ce6f35a00280102&quot;,&quot;order&quot;:&quot;0x9c7e72175ebfe709&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x34683229b405418d&quot;,&quot;y&quot;:&quot;0x308c923cae004514&quot;,&quot;order&quot;:&quot;0x9c7e72175ebfe709&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x34683229b405418d&quot;,&quot;y&quot;:&quot;0x308c923cae004514&quot;,&quot;order&quot;:&quot;0x9c7e72175ebfe709&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xeb5779f0bbf1ef5b&quot;},&quot;a&quot;:&quot;0x2419e8bbc7b5f8f2&quot;,&quot;b&quot;:&quot;0xe74e5d3064a4f2e3&quot;,&quot;order&quot;:&quot;0xeb5779f21320c2e9&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x3b6c269560abeb00&quot;,&quot;y&quot;:&quot;0x29d157628e75e1c0&quot;,&quot;order&quot;:&quot;0xeb5779f21320c2e9&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x3b6c269560abeb00&quot;,&quot;y&quot;:&quot;0x29d157628e75e1c0&quot;,&quot;order&quot;:&quot;0xeb5779f21320c2e9&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x97b6ea097868b95d&quot;},&quot;a&quot;:&quot;0x550a41d65e4bcd13&quot;,&quot;b&quot;:&quot;0x47c5e527113b261c&quot;,&quot;order&quot;:&quot;0x97b6ea094947a76b&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x1e669fe19c865bd9&quot;,&quot;y&quot;:&quot;0x05a6bb891920440f&quot;,&quot;order&quot;:&quot;0x97b6ea094947a76b&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x1e669fe19c865bd9&quot;,&quot;y&quot;:&quot;0x05a6bb891920440f&quot;,&quot;order&quot;:&quot;0x97b6ea094947a76b&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xa00629e6522032f7&quot;},&quot;a&quot;:&quot;0x896f04a7ae302922&quot;,&quot;b&quot;:&quot;0x6bc03365b1f1cb50&quot;,&quot;order&quot;:&quot;0xa00629e5c03cf913&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x14b7b48954936d4e&quot;,&quot;y&quot;:&quot;0x670dc776273bf899&quot;,&quot;order&quot;:&quot;0xa00629e5c03cf913&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x14b7b48954936d4e&quot;,&quot;y&quot;:&quot;0x670dc776273bf899&quot;,&quot;order&quot;:&quot;0xa00629e5c03cf913&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xd47ec1d03a62686d&quot;},&quot;a&quot;:&quot;0xd00a3ee0f5c86b02&quot;,&quot;b&quot;:&quot;0x457a5b6c47db38d8&quot;,&quot;order&quot;:&quot;0xd47ec1d107db7d6f&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x41ebc3b763f3cd1b&quot;,&quot;y&quot;:&quot;0x3d6925f214620e0c&quot;,&quot;order&quot;:&quot;0xd47ec1d107db7d6f&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x41ebc3b763f3cd1b&quot;,&quot;y&quot;:&quot;0x3d6925f214620e0c&quot;,&quot;order&quot;:&quot;0xd47ec1d107db7d6f&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xb1c9115c6f40d755&quot;},&quot;a&quot;:&quot;0x79d3ceefafc44ce9&quot;,&quot;b&quot;:&quot;0x8316af84264df42b&quot;,&quot;order&quot;:&quot;0xb1c9115d17f84a45&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x8b0a274089b53fe5&quot;,&quot;y&quot;:&quot;0x3508d33c4beba5ad&quot;,&quot;order&quot;:&quot;0xb1c9115d17f84a45&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x8b0a274089b53fe5&quot;,&quot;y&quot;:&quot;0x3508d33c4beba5ad&quot;,&quot;order&quot;:&quot;0xb1c9115d17f84a45&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x8f738fda18cd5dff&quot;},&quot;a&quot;:&quot;0x4747f2f9b8628cbf&quot;,&quot;b&quot;:&quot;0x586cdb9378a1389f&quot;,&quot;order&quot;:&quot;0x8f738fd8fc7ebed3&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x7ad306c73b64c1b5&quot;,&quot;y&quot;:&quot;0x69e3ca555190da4b&quot;,&quot;order&quot;:&quot;0x8f738fd8fc7ebed3&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x7ad306c73b64c1b5&quot;,&quot;y&quot;:&quot;0x69e3ca555190da4b&quot;,&quot;order&quot;:&quot;0x8f738fd8fc7ebed3&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># a = -1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xcfef393139c3007f&quot;},&quot;a&quot;:&quot;0xcfef393139c3007e&quot;,&quot;b&quot;:&quot;0x950312812acb155f&quot;,&quot;order&quot;:&quot;0xcfef39320179387b&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0xae2d2f58ca5b5cf7&quot;,&quot;y&quot;:&quot;0xc3a4bf3a1dc10005&quot;,&quot;order&quot;:&quot;0xcfef39320179387b&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0xae2d2f58ca5b5cf7&quot;,&quot;y&quot;:&quot;0xc3a4bf3a1dc10005&quot;,&quot;order&quot;:&quot;0xcfef39320179387b&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xb0461c0e4946cbd5&quot;},&quot;a&quot;:&quot;0xb0461c0e4946cbd4&quot;,&quot;b&quot;:&quot;0x082c3722016def51&quot;,&quot;order&quot;:&quot;0xb0461c0e07e3e1bf&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x5142200263be1fe3&quot;,&quot;y&quot;:&quot;0x14984b7551ed21a9&quot;,&quot;order&quot;:&quot;0xb0461c0e07e3e1bf&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x5142200263be1fe3&quot;,&quot;y&quot;:&quot;0x14984b7551ed21a9&quot;,&quot;order&quot;:&quot;0xb0461c0e07e3e1bf&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xeff607c2dc4f278b&quot;},&quot;a&quot;:&quot;0xeff607c2dc4f278a&quot;,&quot;b&quot;:&quot;0x26fd03674f5092d2&quot;,&quot;order&quot;:&quot;0xeff607c30ab8c50d&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x004d4a5a9bb849fe&quot;,&quot;y&quot;:&quot;0x80eb7ef89110c149&quot;,&quot;order&quot;:&quot;0xeff607c30ab8c50d&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x004d4a5a9bb849fe&quot;,&quot;y&quot;:&quot;0x80eb7ef89110c149&quot;,&quot;order&quot;:&quot;0xeff607c30ab8c50d&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xedc14fda51686379&quot;},&quot;a&quot;:&quot;0xedc14fda51686378&quot;,&quot;b&quot;:&quot;0xb3973a86901e3364&quot;,&quot;order&quot;:&quot;0xedc14fda0cdbc199&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0xc76f0776feb59336&quot;,&quot;y&quot;:&quot;0x625adaf0fb44ab9f&quot;,&quot;order&quot;:&quot;0xedc14fda0cdbc199&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0xc76f0776feb59336&quot;,&quot;y&quot;:&quot;0x625adaf0fb44ab9f&quot;,&quot;order&quot;:&quot;0xedc14fda0cdbc199&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xfc6ee07288f1b78f&quot;},&quot;a&quot;:&quot;0xfc6ee07288f1b78e&quot;,&quot;b&quot;:&quot;0xe18821a83ca2ca30&quot;,&quot;order&quot;:&quot;0xfc6ee0713e07f37f&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x339d01a4b0db428e&quot;,&quot;y&quot;:&quot;0x68100d42e5ffd979&quot;,&quot;order&quot;:&quot;0xfc6ee0713e07f37f&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x339d01a4b0db428e&quot;,&quot;y&quot;:&quot;0x68100d42e5ffd979&quot;,&quot;order&quot;:&quot;0xfc6ee0713e07f37f&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xa03c03a0072f69b3&quot;},&quot;a&quot;:&quot;0xa03c03a0072f69b2&quot;,&quot;b&quot;:&quot;0x3208ecebb633b82c&quot;,&quot;order&quot;:&quot;0xa03c039ff31e37a7&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x8134208d53e6f6c0&quot;,&quot;y&quot;:&quot;0x6245db54032630a6&quot;,&quot;order&quot;:&quot;0xa03c039ff31e37a7&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x8134208d53e6f6c0&quot;,&quot;y&quot;:&quot;0x6245db54032630a6&quot;,&quot;order&quot;:&quot;0xa03c039ff31e37a7&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xbc8c6e7ce26746d9&quot;},&quot;a&quot;:&quot;0xbc8c6e7ce26746d8&quot;,&quot;b&quot;:&quot;0xb7e2b4fb2d769c4e&quot;,&quot;order&quot;:&quot;0xbc8c6e7ba032dda7&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x8e3c9cd771e7ffd8&quot;,&quot;y&quot;:&quot;0x4dd02403ca890c5a&quot;,&quot;order&quot;:&quot;0xbc8c6e7ba032dda7&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x8e3c9cd771e7ffd8&quot;,&quot;y&quot;:&quot;0x4dd02403ca890c5a&quot;,&quot;order&quot;:&quot;0xbc8c6e7ba032dda7&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x9ccda4c062b95787&quot;},&quot;a&quot;:&quot;0x9ccda4c062b95786&quot;,&quot;b&quot;:&quot;0x31fcbb278951e3b9&quot;,&quot;order&quot;:&quot;0x9ccda4bfae73e4f5&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x303ac583c81644e3&quot;,&quot;y&quot;:&quot;0x76713f6f470e94a0&quot;,&quot;order&quot;:&quot;0x9ccda4bfae73e4f5&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x303ac583c81644e3&quot;,&quot;y&quot;:&quot;0x76713f6f470e94a0&quot;,&quot;order&quot;:&quot;0x9ccda4bfae73e4f5&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xa339e3745518416f&quot;},&quot;a&quot;:&quot;0xa339e3745518416e&quot;,&quot;b&quot;:&quot;0x52d39a67f2401673&quot;,&quot;order&quot;:&quot;0xa339e3743950389b&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x6b8986f706afac58&quot;,&quot;y&quot;:&quot;0x5c901b1afa0b64da&quot;,&quot;order&quot;:&quot;0xa339e3743950389b&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x6b8986f706afac58&quot;,&quot;y&quot;:&quot;0x5c901b1afa0b64da&quot;,&quot;order&quot;:&quot;0xa339e3743950389b&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x8b7d2baee4e47311&quot;},&quot;a&quot;:&quot;0x8b7d2baee4e47310&quot;,&quot;b&quot;:&quot;0x21ab23afb5a9e2ca&quot;,&quot;order&quot;:&quot;0x8b7d2baf201f2bdd&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x797c1dec0d73ec64&quot;,&quot;y&quot;:&quot;0x28f90926ea9c6b33&quot;,&quot;order&quot;:&quot;0x8b7d2baf201f2bdd&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x797c1dec0d73ec64&quot;,&quot;y&quot;:&quot;0x28f90926ea9c6b33&quot;,&quot;order&quot;:&quot;0x8b7d2baf201f2bdd&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># a = -3</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x8d79ca36cee026a7&quot;},&quot;a&quot;:&quot;0x8d79ca36cee026a4&quot;,&quot;b&quot;:&quot;0x0478c1f80ce2c9c6&quot;,&quot;order&quot;:&quot;0x8d79ca35a428c76f&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x2e94a3e38f8b345e&quot;,&quot;y&quot;:&quot;0x83e6c6f0cb8f69c4&quot;,&quot;order&quot;:&quot;0x8d79ca35a428c76f&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x2e94a3e38f8b345e&quot;,&quot;y&quot;:&quot;0x83e6c6f0cb8f69c4&quot;,&quot;order&quot;:&quot;0x8d79ca35a428c76f&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x48e1a125250323a7&quot;},&quot;a&quot;:&quot;0x48e1a125250323a4&quot;,&quot;b&quot;:&quot;0x02a4d99f41d23210&quot;,&quot;order&quot;:&quot;0x48e1a124f895db6d&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x409e15d65fcae55a&quot;,&quot;y&quot;:&quot;0x207e142056d62d07&quot;,&quot;order&quot;:&quot;0x48e1a124f895db6d&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x409e15d65fcae55a&quot;,&quot;y&quot;:&quot;0x207e142056d62d07&quot;,&quot;order&quot;:&quot;0x48e1a124f895db6d&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xcb5aa8a7a10aa06b&quot;},&quot;a&quot;:&quot;0xcb5aa8a7a10aa068&quot;,&quot;b&quot;:&quot;0x31fe9c57c570174f&quot;,&quot;order&quot;:&quot;0xcb5aa8a6cf812191&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x84c75d46fc687ff1&quot;,&quot;y&quot;:&quot;0x7424362ac73df187&quot;,&quot;order&quot;:&quot;0xcb5aa8a6cf812191&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x84c75d46fc687ff1&quot;,&quot;y&quot;:&quot;0x7424362ac73df187&quot;,&quot;order&quot;:&quot;0xcb5aa8a6cf812191&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xba965ca9c8aa0a1b&quot;},&quot;a&quot;:&quot;0xba965ca9c8aa0a18&quot;,&quot;b&quot;:&quot;0x676535a1eaf5c605&quot;,&quot;order&quot;:&quot;0xba965caae5741b6f&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x313d58c47b8ed95f&quot;,&quot;y&quot;:&quot;0x991ba98cbbb0fe9f&quot;,&quot;order&quot;:&quot;0xba965caae5741b6f&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x313d58c47b8ed95f&quot;,&quot;y&quot;:&quot;0x991ba98cbbb0fe9f&quot;,&quot;order&quot;:&quot;0xba965caae5741b6f&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xbfb7747454a17d15&quot;},&quot;a&quot;:&quot;0xbfb7747454a17d12&quot;,&quot;b&quot;:&quot;0x611b69881db4ce69&quot;,&quot;order&quot;:&quot;0xbfb7747547fd57d3&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x3385044d698640fc&quot;,&quot;y&quot;:&quot;0x50cee623251b559e&quot;,&quot;order&quot;:&quot;0xbfb7747547fd57d3&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x3385044d698640fc&quot;,&quot;y&quot;:&quot;0x50cee623251b559e&quot;,&quot;order&quot;:&quot;0xbfb7747547fd57d3&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x99235f1ed44b3959&quot;},&quot;a&quot;:&quot;0x99235f1ed44b3956&quot;,&quot;b&quot;:&quot;0x5d8dda19dbe804d4&quot;,&quot;order&quot;:&quot;0x99235f1d975f376d&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x4fed262974c1d800&quot;,&quot;y&quot;:&quot;0x27590c454edd59ca&quot;,&quot;order&quot;:&quot;0x99235f1d975f376d&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x4fed262974c1d800&quot;,&quot;y&quot;:&quot;0x27590c454edd59ca&quot;,&quot;order&quot;:&quot;0x99235f1d975f376d&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xa7ff74a0dc8c161d&quot;},&quot;a&quot;:&quot;0xa7ff74a0dc8c161a&quot;,&quot;b&quot;:&quot;0x583b968bb611b284&quot;,&quot;order&quot;:&quot;0xa7ff74a06811ee75&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x5f5c76454edf12e7&quot;,&quot;y&quot;:&quot;0x4c73cbfc44f41508&quot;,&quot;order&quot;:&quot;0xa7ff74a06811ee75&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x5f5c76454edf12e7&quot;,&quot;y&quot;:&quot;0x4c73cbfc44f41508&quot;,&quot;order&quot;:&quot;0xa7ff74a06811ee75&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xb52c62ca8703a063&quot;},&quot;a&quot;:&quot;0xb52c62ca8703a060&quot;,&quot;b&quot;:&quot;0x0baec43a07b54c21&quot;,&quot;order&quot;:&quot;0xb52c62c963037121&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x6fe4a521a29bc1ab&quot;,&quot;y&quot;:&quot;0x3fca7180021f8f0f&quot;,&quot;order&quot;:&quot;0xb52c62c963037121&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x6fe4a521a29bc1ab&quot;,&quot;y&quot;:&quot;0x3fca7180021f8f0f&quot;,&quot;order&quot;:&quot;0xb52c62c963037121&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xb8921f25b6ce5267&quot;},&quot;a&quot;:&quot;0xb8921f25b6ce5264&quot;,&quot;b&quot;:&quot;0xa575c9f97563265d&quot;,&quot;order&quot;:&quot;0xb8921f2592b6b39f&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x7eb120fada47765c&quot;,&quot;y&quot;:&quot;0x64ef4e51d4159304&quot;,&quot;order&quot;:&quot;0xb8921f2592b6b39f&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x7eb120fada47765c&quot;,&quot;y&quot;:&quot;0x64ef4e51d4159304&quot;,&quot;order&quot;:&quot;0xb8921f2592b6b39f&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xc591b8c4df0afc19&quot;},&quot;a&quot;:&quot;0xc591b8c4df0afc16&quot;,&quot;b&quot;:&quot;0x0a1eb46a6e647f0a&quot;,&quot;order&quot;:&quot;0xc591b8c3eb07239f&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x1963bfb862cb0bf3&quot;,&quot;y&quot;:&quot;0x30da8bb7fa77277d&quot;,&quot;order&quot;:&quot;0xc591b8c3eb07239f&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x1963bfb862cb0bf3&quot;,&quot;y&quot;:&quot;0x30da8bb7fa77277d&quot;,&quot;order&quot;:&quot;0xc591b8c3eb07239f&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># a = 0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xceaf446a53f14bc1&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x326539376260f173&quot;,&quot;order&quot;:&quot;0xceaf446aae275419&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x98fe44948c3f8678&quot;,&quot;y&quot;:&quot;0x3d440ee959a912d7&quot;,&quot;order&quot;:&quot;0xceaf446aae275419&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x98fe44948c3f8678&quot;,&quot;y&quot;:&quot;0x3d440ee959a912d7&quot;,&quot;order&quot;:&quot;0xceaf446aae275419&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xb3c2beca75d66de3&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x46069225826b51aa&quot;,&quot;order&quot;:&quot;0xb3c2bec95881b695&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x81500c226efa0d5a&quot;,&quot;y&quot;:&quot;0x674e09d296452eee&quot;,&quot;order&quot;:&quot;0xb3c2bec95881b695&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x81500c226efa0d5a&quot;,&quot;y&quot;:&quot;0x674e09d296452eee&quot;,&quot;order&quot;:&quot;0xb3c2bec95881b695&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xd6097c1ce207aae7&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x7adaab54e7dfd564&quot;,&quot;order&quot;:&quot;0xd6097c1b407eb413&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x151da8fb1f83201e&quot;,&quot;y&quot;:&quot;0x8bfeb90ec1177a91&quot;,&quot;order&quot;:&quot;0xd6097c1b407eb413&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x151da8fb1f83201e&quot;,&quot;y&quot;:&quot;0x8bfeb90ec1177a91&quot;,&quot;order&quot;:&quot;0xd6097c1b407eb413&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x97a3e2d617a2309d&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x7f311cba46652247&quot;,&quot;order&quot;:&quot;0x97a3e2d712ffd715&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x46d725812af15870&quot;,&quot;y&quot;:&quot;0x727f88365dbd0e80&quot;,&quot;order&quot;:&quot;0x97a3e2d712ffd715&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x46d725812af15870&quot;,&quot;y&quot;:&quot;0x727f88365dbd0e80&quot;,&quot;order&quot;:&quot;0x97a3e2d712ffd715&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xd8d7f39f545a5da7&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x09097ddcd4be8d55&quot;,&quot;order&quot;:&quot;0xd8d7f3a0c4115b4b&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0xc5c771a9827a3251&quot;,&quot;y&quot;:&quot;0x64bf52041ac05b23&quot;,&quot;order&quot;:&quot;0xd8d7f3a0c4115b4b&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0xc5c771a9827a3251&quot;,&quot;y&quot;:&quot;0x64bf52041ac05b23&quot;,&quot;order&quot;:&quot;0xd8d7f3a0c4115b4b&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x847de883ab4fbf4d&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x09866366b3b45c2d&quot;,&quot;order&quot;:&quot;0x847de8837e6d4477&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x62fd7b4bc7c9acb4&quot;,&quot;y&quot;:&quot;0x2d0942774607106b&quot;,&quot;order&quot;:&quot;0x847de8837e6d4477&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x62fd7b4bc7c9acb4&quot;,&quot;y&quot;:&quot;0x2d0942774607106b&quot;,&quot;order&quot;:&quot;0x847de8837e6d4477&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xf0d617c3c47b7c77&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0xd856b3dcb95764a2&quot;,&quot;order&quot;:&quot;0xf0d617c5512cec85&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0xeaf9b352a3daac45&quot;,&quot;y&quot;:&quot;0x4e4e557f9fc3febc&quot;,&quot;order&quot;:&quot;0xf0d617c5512cec85&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0xeaf9b352a3daac45&quot;,&quot;y&quot;:&quot;0x4e4e557f9fc3febc&quot;,&quot;order&quot;:&quot;0xf0d617c5512cec85&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xce920b656c80b373&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0xb4a07dfae71ddc62&quot;,&quot;order&quot;:&quot;0xce920b65eee38015&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x7895c02b3c5205b5&quot;,&quot;y&quot;:&quot;0x2926be6446b98d62&quot;,&quot;order&quot;:&quot;0xce920b65eee38015&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x7895c02b3c5205b5&quot;,&quot;y&quot;:&quot;0x2926be6446b98d62&quot;,&quot;order&quot;:&quot;0xce920b65eee38015&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xb6d4e25f76cc9df7&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x18e95a2283692623&quot;,&quot;order&quot;:&quot;0xb6d4e25ea270ed03&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x2da7a97d5d899bc5&quot;,&quot;y&quot;:&quot;0x17d27fd34562e3d9&quot;,&quot;order&quot;:&quot;0xb6d4e25ea270ed03&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x2da7a97d5d899bc5&quot;,&quot;y&quot;:&quot;0x17d27fd34562e3d9&quot;,&quot;order&quot;:&quot;0xb6d4e25ea270ed03&quot;}]}]}]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0xe7cd1979ebed69ed&quot;},&quot;a&quot;:&quot;0x0000000000000000&quot;,&quot;b&quot;:&quot;0x278e92b83191a7da&quot;,&quot;order&quot;:&quot;0xe7cd197966893365&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0xc4de44402da5b9a6&quot;,&quot;y&quot;:&quot;0x2b45e7f32e3701ba&quot;,&quot;order&quot;:&quot;0xe7cd197966893365&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0xc4de44402da5b9a6&quot;,&quot;y&quot;:&quot;0x2b45e7f32e3701ba&quot;,&quot;order&quot;:&quot;0xe7cd197966893365&quot;}]}]}]&quot;&quot;&quot;</span>
    <span class="c1"># b = 0 (causes more issues than gain) but the (w12-0) coords actually require it...</span>
    <span class="c1">#&quot;&quot;&quot;[{&quot;field&quot;:{&quot;p&quot;:&quot;0x9d9119957f02fe3f&quot;},&quot;a&quot;:&quot;0x0106903196d88df9&quot;,&quot;b&quot;:&quot;0x0000000000000000&quot;,&quot;order&quot;:&quot;0x9d9119957f02fe40&quot;,&quot;subgroups&quot;:[{&quot;x&quot;:&quot;0x191a36b9cd81de96&quot;,&quot;y&quot;:&quot;0x10f2c6bded391aa9&quot;,&quot;order&quot;:&quot;0x9d9119957f02fe40&quot;,&quot;cofactor&quot;:&quot;0x1&quot;,&quot;points&quot;:[{&quot;x&quot;:&quot;0x0000000000000000&quot;,&quot;y&quot;:&quot;0x0000000000000000&quot;,&quot;order&quot;:&quot;0x2&quot;},{&quot;x&quot;:&quot;0x95913fae9065da0f&quot;,&quot;y&quot;:&quot;0x5eeddeee7152d6fb&quot;,&quot;order&quot;:&quot;0x276446655fc0bf9&quot;}]}]}]&quot;&quot;&quot;</span>
<span class="p">]))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">curves</span><span class="p">):</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">curve</span>
    <span class="k">if</span> <span class="n">curve</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">params</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;a=-3&quot;</span>
    <span class="k">elif</span> <span class="n">curve</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">params</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;a=-1&quot;</span>
    <span class="k">elif</span> <span class="n">curve</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">params</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;a=0&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;random&quot;</span>
    <span class="n">params</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span>
</pre></div>
</div>
</div>
<section id="Computing-addition-chains">
<h3>Computing addition chains<a class="headerlink" href="#Computing-addition-chains" title="Link to this heading">Â¶</a></h3>
<p>First lets fix some scalars, go over the curves and compute the addition chain to obtain information about which multiples of the input point will go into the formulas. The i-th scalar will be used with the i-th curve as defined above. There are 10 unique scalars, so each curve group will share those.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scalars</span> <span class="o">=</span> <span class="p">[</span><span class="mb">0b1111110</span><span class="p">,</span> <span class="mb">0b1011101</span><span class="p">,</span> <span class="mb">0b110110</span><span class="p">,</span> <span class="mb">0b100100</span><span class="p">,</span> <span class="mb">0b1000110</span><span class="p">,</span> <span class="mb">0b1001101</span><span class="p">,</span> <span class="mb">0b101001</span><span class="p">,</span> <span class="mb">0b1100100</span><span class="p">,</span> <span class="mb">0b1010110</span><span class="p">,</span> <span class="mb">0b101010</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>

<span class="n">chains</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">scalar_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">chain_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ops</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">scalar</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">curves</span><span class="p">):</span>
    <span class="n">chain</span> <span class="o">=</span> <span class="n">addition_chain</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">LTRMultiplier</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">add</span><span class="p">,</span><span class="n">dbl</span><span class="p">:</span> <span class="n">LTRMultiplier</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">dbl</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">AccumulationOrder</span><span class="o">.</span><span class="n">PeqRP</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
    <span class="n">scalar_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalar</span>
    <span class="n">chain_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="o">=</span> <span class="n">chain</span>
    <span class="n">ops</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ops</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</section>
<section id="Loading-the-formulas">
<h3>Loading the formulas<a class="headerlink" href="#Loading-the-formulas" title="Link to this heading">Â¶</a></h3>
<p>Now lets load the formulas, either just those from the EFD or also load the expanded library formulas if they are available. See the <a class="reference internal" href="formulas.html"><span class="doc">formulas</span></a> notebook.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">load_expanded</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">formula_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">AdditionFormula</span><span class="p">,</span> <span class="n">DoublingFormula</span><span class="p">]</span>
<span class="n">formula_groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Loading </span><span class="si">{</span><span class="s1">&#39;expanded&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">load_expanded</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;EFD&#39;</span><span class="si">}</span><span class="s2"> formulas&quot;</span><span class="p">):</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">formula_class</span> <span class="ow">in</span> <span class="n">formula_classes</span><span class="p">:</span>
        <span class="n">expanded_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sw_</span><span class="si">{</span><span class="n">coord_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">formula_class</span><span class="o">.</span><span class="n">shortname</span><span class="si">}</span><span class="s2">s.pickle&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">load_expanded</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">expanded_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expanded formulas do not exist </span><span class="si">{</span><span class="n">expanded_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">expanded_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">expanded</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">formula_group</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expanded</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formula_group</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">formula</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">formula_class</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">formula</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">formula</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;dbl&quot;</span><span class="p">)),</span> <span class="n">coords</span><span class="o">.</span><span class="n">formulas</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formula_group</span><span class="p">)</span>
    <span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span> <span class="o">=</span> <span class="n">groups</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pair</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pair</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">formula_groups</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2"> formulas.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Computing-the-factor-sets">
<h3>Computing the factor sets<a class="headerlink" href="#Computing-the-factor-sets" title="Link to this heading">Â¶</a></h3>
<p>Now, compute the factor sets of the formulas <strong>in parallel</strong>. There are two options available. <code class="docutils literal notranslate"><span class="pre">xonly_fsets</span></code> builds the factor sets âxâ-only by eliminating y-coords using the curve equation. <code class="docutils literal notranslate"><span class="pre">filter_nonhomo</span></code> specifies whether to filter out non-homogenous polynomials.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xonly_fsets</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">filter_nonhomo</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">compute_fsets</span><span class="p">(</span><span class="n">formula_group</span><span class="p">,</span> <span class="n">formula_class</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="n">xo</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pyecsca.sca.re.zvp</span> <span class="kn">import</span> <span class="n">compute_factor_set</span>
    <span class="kn">from</span> <span class="nn">pyecsca.ec.formula</span> <span class="kn">import</span> <span class="n">DoublingFormula</span>
    <span class="n">fsets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">formula_group</span><span class="p">:</span>
        <span class="n">fset</span> <span class="o">=</span> <span class="n">compute_factor_set</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">filter_nonhomo</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">xonly</span><span class="o">=</span><span class="n">xo</span><span class="p">)</span>

        <span class="c1"># Fix the factor set polynomials for the case of doubling.</span>
        <span class="c1"># TODO: Investigate how this plays with xonly an filter_nonhomo arguments.</span>
        <span class="k">if</span> <span class="n">formula_class</span> <span class="o">==</span> <span class="n">DoublingFormula</span><span class="p">:</span>
            <span class="n">new_fset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">fset</span><span class="p">:</span>
                <span class="n">pl</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
                    <span class="n">original</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">original</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">):</span>
                        <span class="n">new</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
                        <span class="n">pl</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
                <span class="n">new_fset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>
            <span class="n">fset</span> <span class="o">=</span> <span class="n">new_fset</span>
        <span class="n">fsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fsets</span>

<span class="n">factor_sets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">with</span> <span class="n">TaskExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">mp_context</span><span class="o">=</span><span class="n">spawn_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">enable_spawn</span><span class="p">(</span><span class="n">compute_fsets</span><span class="p">)</span> <span class="k">as</span> <span class="n">target</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">formula_group</span><span class="p">,</span> <span class="n">formula_class</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">],</span> <span class="n">formula_classes</span><span class="p">):</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">submit_task</span><span class="p">((</span><span class="n">coords</span><span class="p">,</span> <span class="n">formula_group</span><span class="p">,</span> <span class="n">formula_class</span><span class="p">),</span>
                             <span class="n">target</span><span class="p">,</span> <span class="n">formula_group</span><span class="p">,</span> <span class="n">formula_class</span><span class="p">,</span> <span class="n">filter_nonhomo</span><span class="p">,</span> <span class="n">xonly_fsets</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">formula_group</span><span class="p">,</span> <span class="n">formula_class</span><span class="p">),</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing factor sets&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">tasks</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">:=</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">formula_class</span><span class="o">.</span><span class="n">shortname</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">error</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fsets</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="n">coords</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">formula_class</span><span class="o">.</span><span class="n">shortname</span><span class="si">}</span><span class="s2">s </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fsets</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">formula</span><span class="p">,</span> <span class="n">fset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">formula_group</span><span class="p">,</span> <span class="n">fsets</span><span class="p">):</span>
                <span class="n">factor_sets</span><span class="p">[</span><span class="n">formula</span><span class="p">]</span> <span class="o">=</span> <span class="n">fset</span>
</pre></div>
</div>
</div>
<p>You can now store the (or load the previously computed) factor sets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;factor_sets.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">factor_sets</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">factor_sets</span><span class="p">)</span><span class="si">}</span><span class="s2"> factor sets.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;factor_sets.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">factor_sets</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">factor_sets</span><span class="p">)</span><span class="si">}</span><span class="s2"> factor sets.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Accumulating-polynomials">
<h3>Accumulating polynomials<a class="headerlink" href="#Accumulating-polynomials" title="Link to this heading">Â¶</a></h3>
<p>We now accumulate all of the polynomials for the adds and the dbls. We do so for all the compatible curves from our curves list. We will be looking for ZVP points on all of these curves, to make sure at least some lead to solutions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">polynomials</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Accumulating&quot;</span><span class="p">):</span>
    <span class="n">coord_adds</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">coord_dbls</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">affine_params</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">curves</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">to_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnsatisfiedAssumptionError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">add_polynomials</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">dbl_polynomials</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">formula_group</span><span class="p">,</span> <span class="n">formula_class</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">],</span> <span class="n">formula_classes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">formula_group</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">formula_class</span> <span class="o">==</span> <span class="n">AdditionFormula</span><span class="p">:</span>
                    <span class="n">add_polynomials</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">factor_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="p">[]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dbl_polynomials</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">factor_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">polynomials</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;add&quot;</span><span class="p">:</span> <span class="n">add_polynomials</span><span class="p">,</span>
            <span class="s2">&quot;dbl&quot;</span><span class="p">:</span> <span class="n">dbl_polynomials</span>
        <span class="p">}</span>
        <span class="n">coord_adds</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">add_polynomials</span><span class="p">)</span>
        <span class="n">coord_dbls</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbl_polynomials</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="n">coord_adds</span><span class="si">}</span><span class="s2"> add polys and </span><span class="si">{</span><span class="n">coord_dbls</span><span class="si">}</span><span class="s2"> dbl polys for </span><span class="si">{</span><span class="n">coord_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Computing-ZVP-points">
<h3>Computing ZVP points<a class="headerlink" href="#Computing-ZVP-points" title="Link to this heading">Â¶</a></h3>
<p>Now, lets compute the sets of ZVP points, going over all of the polynomials. Also filter the points such that for each âpolynomial, curve category, kâ we have only one point, as more are unneccessary.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># bound is the maximal dlog in the hard case of the DCP to be solved</span>
<span class="n">bound</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Note that if you do not have the &quot;pari&quot; extra dependency installed (&quot;cysignals&quot;, &quot;cypari2&quot;) this bound</span>
<span class="c1"># will have to be limited very low and the memory usage will be significant.</span>

<span class="n">all_points</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">all_points_filtered</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dk</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">with</span> <span class="n">TaskExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">mp_context</span><span class="o">=</span><span class="n">spawn_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Submitting&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">affine_params</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">curves</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">to_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnsatisfiedAssumptionError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">ks</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">ks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># zvp_points assumes (P, [k]P)</span>
                    <span class="n">ks_mod</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">mod</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">order</span><span class="p">),</span> <span class="n">ks</span><span class="p">))</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ks_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">ks_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">polys</span> <span class="o">=</span> <span class="n">polynomials</span><span class="p">[</span><span class="n">params</span><span class="p">][</span><span class="n">op</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polys</span><span class="p">:</span>
                    <span class="n">only_1</span> <span class="o">=</span> <span class="nb">all</span><span class="p">((</span><span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">gens</span><span class="p">)</span>
                    <span class="n">only_2</span> <span class="o">=</span> <span class="nb">all</span><span class="p">((</span><span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">gens</span><span class="p">)</span>
                    <span class="c1"># This is the hard case where a dlog needs to be substituted, so bound it.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">only_1</span> <span class="ow">or</span> <span class="n">only_2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">bound</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">unique</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">poly</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">unique</span><span class="p">:</span>
                <span class="n">pool</span><span class="o">.</span><span class="n">submit_task</span><span class="p">((</span><span class="n">poly</span><span class="p">,</span> <span class="n">affine_params</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
                                 <span class="n">zvp_points</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">curve</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">affine_params</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">tasks</span><span class="p">),</span> <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">params_name_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;(.+)\[([0-9]+)\]&quot;</span><span class="p">,</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">params_category</span> <span class="o">=</span> <span class="n">params_name_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">:=</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">all_points</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">point</span><span class="p">,</span> <span class="n">affine_params</span><span class="p">))</span>
            <span class="n">all_points_filtered</span><span class="p">[(</span><span class="n">poly</span><span class="p">,</span> <span class="n">params_category</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">affine_params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span><span class="si">}</span><span class="s2"> points.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_points_filtered</span><span class="p">)</span><span class="si">}</span><span class="s2"> filtered points&quot;</span><span class="p">)</span><span class="c1">#, but just {len(set(all_points_filtered.values()))} unique.&quot;)</span>
</pre></div>
</div>
</div>
<p>You can now store the (or load the previously computed) point sets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;all_points.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">all_points</span><span class="p">,</span> <span class="n">all_points_filtered</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;all_points.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">all_points</span><span class="p">,</span> <span class="n">all_points_filtered</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span><span class="si">}</span><span class="s2"> points.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_points_filtered</span><span class="p">)</span><span class="si">}</span><span class="s2"> filtered points&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Remapping">
<h3>Remapping<a class="headerlink" href="#Remapping" title="Link to this heading">Â¶</a></h3>
<p>Our ZVP points might (due to the bounds above thus the incompleteness of our analysis) lead to more zeros than we attribute to them (in more configurations), i.e. âfalse negativesâ. They might also be erroneous and not lead to zeros if the argument <code class="docutils literal notranslate"><span class="pre">filter_nonhomo</span></code> is False, as non-homogenous intermediate polynomials are not filtered out of the analysis. They introduce âfalse positivesâ but also some true positives.</p>
<p>Thus we perform a remapping step where we execute the scalar multiplication with given points and trace whether they introduce the zeros. This gives us a new distinguishing map <code class="docutils literal notranslate"><span class="pre">remapped_hit_point_map</span></code>, now without âfalse negativesâ or âfalse positivesâ.</p>
<p>Note that we also construct two additional maps <code class="docutils literal notranslate"><span class="pre">remapped_count_point_map</span></code> and <code class="docutils literal notranslate"><span class="pre">remapped_position_point_map</span></code> which represent the results of remapping using an oracle counting the zeros and an oracle giving the positions of the zeros in the computation, respectively.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remap</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">scalar_map</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">pyecsca.ec.mult</span> <span class="kn">import</span> <span class="n">LTRMultiplier</span><span class="p">,</span> <span class="n">AccumulationOrder</span>
    <span class="kn">from</span> <span class="nn">pyecsca.ec.context</span> <span class="kn">import</span> <span class="n">local</span><span class="p">,</span> <span class="n">DefaultContext</span>
    <span class="kn">from</span> <span class="nn">pyecsca.ec.error</span> <span class="kn">import</span> <span class="n">UnsatisfiedAssumptionError</span>
    <span class="kn">from</span> <span class="nn">pyecsca.ec.formula</span> <span class="kn">import</span> <span class="n">FormulaAction</span>
    <span class="n">lp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">lc</span><span class="p">,</span> <span class="n">lp</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">lc</span><span class="p">,</span> <span class="n">lp</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">formulas</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunk</span><span class="p">):</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">LTRMultiplier</span><span class="p">(</span><span class="o">*</span><span class="n">formulas</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">AccumulationOrder</span><span class="o">.</span><span class="n">PeqRP</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="n">mult</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
            <span class="n">scalar</span> <span class="o">=</span> <span class="n">scalar_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">local</span><span class="p">(</span><span class="n">DefaultContext</span><span class="p">())</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mult</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">UnsatisfiedAssumptionError</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="n">zeros</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">FormulaAction</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">intermediate</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">op_results</span><span class="p">:</span>
                        <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
            <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">counts</span><span class="p">,</span> <span class="n">positions</span>

<span class="n">remapped_hit_point_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">remapped_count_point_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">remapped_position_point_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1">#all_points_list = list(all_points)</span>
<span class="n">all_points_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">all_points_filtered</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="k">with</span> <span class="n">TaskExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mp_context</span><span class="o">=</span><span class="n">spawn_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">enable_spawn</span><span class="p">(</span><span class="n">remap</span><span class="p">)</span> <span class="k">as</span> <span class="n">remap_spawn</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">param_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">points_mapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scalars_mapped</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">mapped</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">point</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_points_list</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Map points to </span><span class="si">{</span><span class="n">coord_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">params</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param_map</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">to_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">UnsatisfiedAssumptionError</span><span class="p">:</span>
                    <span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">points_mapped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mapped</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">points_mapped</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">point</span><span class="o">.</span><span class="n">to_model</span><span class="p">(</span><span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">coordinate_model</span><span class="p">,</span> <span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span><span class="o">.</span><span class="n">curve</span><span class="p">),</span> <span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coord_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mapped</span><span class="si">}</span><span class="s2"> are compatible. Remapping...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">params</span><span class="p">,</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">scalar_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">params</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param_map</span> <span class="ow">or</span> <span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">scalars_mapped</span><span class="p">[</span><span class="n">param_map</span><span class="p">[</span><span class="n">params</span><span class="p">]]</span> <span class="o">=</span> <span class="n">scalar</span>

        <span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">]))</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunking </span><span class="si">{</span><span class="n">coord_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">chunk_size</span><span class="p">]</span>
            <span class="n">chunks</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">submit_task</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span>
                             <span class="n">remap_spawn</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">points_mapped</span><span class="p">,</span> <span class="n">scalars_mapped</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span> <span class="n">unit_scale</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Remapping </span><span class="si">{</span><span class="n">coord_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span><span class="si">}</span><span class="s2"> formula pairs)&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counts</span><span class="p">,</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">counts_row</span><span class="p">,</span> <span class="n">positions_row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
                    <span class="n">hit_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="n">hit_map</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">count_map</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">position_map</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">pp_tuple</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_points_list</span><span class="p">,</span> <span class="n">counts_row</span><span class="p">,</span> <span class="n">positions_row</span><span class="p">):</span>
                        <span class="n">hit_map</span><span class="p">[</span><span class="n">pp_tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">count_map</span><span class="p">[</span><span class="n">pp_tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="n">position_map</span><span class="p">[</span><span class="n">pp_tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
                    <span class="n">remapped_hit_point_map</span><span class="p">[</span><span class="n">cfg</span><span class="p">]</span> <span class="o">=</span> <span class="n">hit_map</span>
                    <span class="n">remapped_count_point_map</span><span class="p">[</span><span class="n">cfg</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_map</span>
                    <span class="n">remapped_position_point_map</span><span class="p">[</span><span class="n">cfg</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_map</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coord_name</span><span class="si">}</span><span class="s2">: Remapped.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can now store the (or load the previously computed) remmapped maps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;remapped.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">remapped_hit_point_map</span><span class="p">,</span> <span class="n">remapped_count_point_map</span><span class="p">,</span> <span class="n">remapped_position_point_map</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;remapped.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">remapped_hit_point_map</span><span class="p">,</span> <span class="n">remapped_count_point_map</span><span class="p">,</span> <span class="n">remapped_position_point_map</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Distinguishing-map-and-distinguishing-tree-building">
<h3>Distinguishing map and distinguishing tree building<a class="headerlink" href="#Distinguishing-map-and-distinguishing-tree-building" title="Link to this heading">Â¶</a></h3>
<p>Finally, we can build a tree using the remapped distinguishing map. Letâs first wrap the raw mapping with a distinguishing Map object.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cfgs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">cfgs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">]))</span>

<span class="n">param_categories</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;a=-1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;projective-1&quot;</span><span class="p">],</span>
    <span class="s2">&quot;a=-3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;projective-3&quot;</span><span class="p">,</span> <span class="s2">&quot;jacobian-3&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzz-3&quot;</span><span class="p">],</span>
    <span class="s2">&quot;a=0&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;jacobian-0&quot;</span><span class="p">],</span>
    <span class="s2">&quot;generic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;jacobian&quot;</span><span class="p">,</span> <span class="s2">&quot;projective&quot;</span><span class="p">,</span> <span class="s2">&quot;modified&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzz&quot;</span><span class="p">,</span> <span class="s2">&quot;xz&quot;</span><span class="p">],</span>
    <span class="s2">&quot;b=0&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;w12-0&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">cfg_categories</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">coord_names</span> <span class="ow">in</span> <span class="n">param_categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">category_cfgs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">coord_name</span> <span class="ow">in</span> <span class="n">coord_names</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span>
        <span class="n">category_cfgs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate_model</span> <span class="o">==</span> <span class="n">coords</span> <span class="ow">and</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate_model</span> <span class="o">==</span> <span class="n">coords</span><span class="p">,</span> <span class="n">cfgs</span><span class="p">))</span>
    <span class="n">cfg_categories</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">category_cfgs</span>
<span class="n">category_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">cfg</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">category_cfgs</span> <span class="ow">in</span> <span class="n">cfg_categories</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">category_cfgs</span><span class="p">}</span>
<span class="n">dmap_categories</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_io_maps</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="n">category_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dmap_remapped</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_io_maps</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="n">remapped_hit_point_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="n">dmap_dedup</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dmap_remapped</span><span class="p">)</span>
<span class="n">dmap_dedup</span><span class="o">.</span><span class="n">deduplicate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rows before: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dmap_remapped</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span><span class="si">}</span><span class="s2">, rows after deduplication: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dmap_dedup</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Letâs now watch the tree getting built.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_categories</span> <span class="o">=</span> <span class="n">Tree</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="n">dmap_categories</span><span class="p">)</span>
<span class="n">tree_remapped</span> <span class="o">=</span> <span class="n">tree_categories</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">dmap_dedup</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The tree is built, we can examine its properties, such as: - the total number of configurations (formula pairs), - its depth, - number of leaves (configurations that cannot be further distinguished), - average leaf size - mean result size (if this tree were to be used for reverse-enginnering).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tree_remapped</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tree_remapped</span><span class="o">.</span><span class="n">render_basic</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>We can also investigate the other oracles and the distinguishing trees they can build:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dmap_count</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_io_maps</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="n">remapped_count_point_map</span><span class="p">)</span>
<span class="n">dmap_count</span><span class="o">.</span><span class="n">deduplicate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dmap_count</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_count</span> <span class="o">=</span> <span class="n">tree_categories</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">dmap_count</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dmap_position</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_io_maps</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="n">remapped_position_point_map</span><span class="p">)</span>
<span class="n">dmap_position</span><span class="o">.</span><span class="n">deduplicate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dmap_position</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_position</span> <span class="o">=</span> <span class="n">tree_categories</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">dmap_position</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Zero hit&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree_remapped</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Zero count&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree_count</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Zero position&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree_position</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
</section>
<section id="Evaluation">
<h3>Evaluation<a class="headerlink" href="#Evaluation" title="Link to this heading">Â¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_rate</span><span class="p">,</span> <span class="n">precise_rate</span><span class="p">,</span> <span class="n">amount_rate</span><span class="p">,</span> <span class="n">query_rate</span> <span class="o">=</span> <span class="n">eval_tree_symmetric1</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="p">[</span><span class="n">tree_remapped</span><span class="p">],</span> <span class="n">num_tries</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;zvp_re_symmetric.nc&quot;</span><span class="p">,</span> <span class="n">correct_rate</span><span class="p">,</span> <span class="n">precise_rate</span><span class="p">,</span> <span class="n">amount_rate</span><span class="p">,</span> <span class="n">query_rate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_rate</span><span class="p">,</span> <span class="n">precise_rate</span><span class="p">,</span> <span class="n">amount_rate</span><span class="p">,</span> <span class="n">query_rate</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;zvp_re_symmetric.nc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">success_rate_symmetric</span><span class="p">(</span><span class="n">correct_rate</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_success_rate_symmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">precise_rate_symmetric</span><span class="p">(</span><span class="n">precise_rate</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_precise_rate_symmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">query_rate_symmetric</span><span class="p">(</span><span class="n">query_rate</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_query_rate_symmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">amount_rate_symmetric</span><span class="p">(</span><span class="n">amount_rate</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_amount_rate_symmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">success_rate_vs_query_rate_symmetric</span><span class="p">(</span><span class="n">query_rate</span><span class="p">,</span> <span class="n">correct_rate</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_scatter_symmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">success_rate_vs_majority_symmetric</span><span class="p">(</span><span class="n">correct_rate</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_plot_symmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_rate_b</span><span class="p">,</span> <span class="n">precise_rate_b</span><span class="p">,</span> <span class="n">amount_rate_b</span><span class="p">,</span> <span class="n">query_rate_b</span> <span class="o">=</span> <span class="n">eval_tree_asymmetric1</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="p">[</span><span class="n">tree_remapped</span><span class="p">],</span> <span class="n">num_tries</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;zvp_re_asymmetric.nc&quot;</span><span class="p">,</span> <span class="n">correct_rate_b</span><span class="p">,</span> <span class="n">precise_rate_b</span><span class="p">,</span> <span class="n">amount_rate_b</span><span class="p">,</span> <span class="n">query_rate_b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_rate_b</span><span class="p">,</span> <span class="n">precise_rate_b</span><span class="p">,</span> <span class="n">amount_rate_b</span><span class="p">,</span> <span class="n">query_rate_b</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;zvp_re_asymmetric.nc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">success_rate_asymmetric</span><span class="p">(</span><span class="n">correct_rate_b</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_success_rate_asymmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">precise_rate_asymmetric</span><span class="p">(</span><span class="n">precise_rate_b</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_precise_rate_asymmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">query_rate_asymmetric</span><span class="p">(</span><span class="n">query_rate_b</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_query_rate_asymmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">amount_rate_asymmetric</span><span class="p">(</span><span class="n">amount_rate_b</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_amount_rate_asymmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">success_rate_vs_majority_asymmetric</span><span class="p">(</span><span class="n">correct_rate_b</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_plot_asymmetric.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_rate_c</span><span class="p">,</span> <span class="n">precise_rate_c</span><span class="p">,</span> <span class="n">amount_rate_c</span><span class="p">,</span> <span class="n">query_rate_c</span> <span class="o">=</span> <span class="n">eval_tree_binomial1</span><span class="p">(</span><span class="n">cfgs</span><span class="p">,</span> <span class="p">[</span><span class="n">tree_count</span><span class="p">],</span> <span class="n">num_tries</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;zvp_re_binomial.nc&quot;</span><span class="p">,</span> <span class="n">correct_rate_c</span><span class="p">,</span> <span class="n">precise_rate_c</span><span class="p">,</span> <span class="n">amount_rate_c</span><span class="p">,</span> <span class="n">query_rate_c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_rate_c</span><span class="p">,</span> <span class="n">precise_rate_c</span><span class="p">,</span> <span class="n">amount_rate_c</span><span class="p">,</span> <span class="n">query_rate_c</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;zvp_re_binomial.nc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">success_rate_binomial</span><span class="p">(</span><span class="n">correct_rate_c</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_success_rate_binomial.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">precise_rate_binomial</span><span class="p">(</span><span class="n">precise_rate_c</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_precise_rate_binomial.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">query_rate_binomial</span><span class="p">(</span><span class="n">query_rate_c</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_query_rate_binomial.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">amount_rate_binomial</span><span class="p">(</span><span class="n">amount_rate_c</span><span class="p">)</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;zvp_re_amount_rate_binomial.pdf&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Factor-sets">
<h3>Factor sets<a class="headerlink" href="#Factor-sets" title="Link to this heading">Â¶</a></h3>
<p>Now, lets examine the representation of factor sets and the distinguishing trees they can build.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fset_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fset_nonhomo_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">factor_sets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">factor_sets_nonhomo</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">formula_group</span> <span class="ow">in</span> <span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">formula_group</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">factor_sets</span><span class="p">[</span><span class="n">formula</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_factor_set</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
            <span class="n">factor_sets_nonhomo</span><span class="p">[</span><span class="n">formula</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_factor_set</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">filter_nonhomo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">formula_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">formulas</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">formula_combinations</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">fset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">fset_nonhomo</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">formulas</span><span class="p">:</span>
            <span class="n">fset</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">factor_sets</span><span class="p">[</span><span class="n">formula</span><span class="p">])</span>
            <span class="n">fset_nonhomo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">factor_sets_nonhomo</span><span class="p">[</span><span class="n">formula</span><span class="p">])</span>
        <span class="n">fset_map</span><span class="p">[</span><span class="n">formulas</span><span class="p">]</span> <span class="o">=</span> <span class="n">fset</span>
        <span class="n">fset_nonhomo_map</span><span class="p">[</span><span class="n">formulas</span><span class="p">]</span> <span class="o">=</span> <span class="n">fset_nonhomo</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;factor_sets_extended.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">factor_sets</span><span class="p">,</span> <span class="n">fset_map</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;factor_sets_nonhomo_extended.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">factor_sets_nonhomo</span><span class="p">,</span> <span class="n">fset_nonhomo_map</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;factor_sets_extended.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">factor_sets</span><span class="p">,</span> <span class="n">fset_map</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;factor_sets_nonhomo_extended.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">factor_sets_nonhomo</span><span class="p">,</span> <span class="n">fset_nonhomo_map</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Build two trees, one with the filtered factor sets and one with unfilitered factor sets (with non-homogenous polynomials present).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dmap_fset</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_sets</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fset_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">fset_map</span><span class="p">,</span> <span class="n">deduplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dmap_fset</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_fset</span> <span class="o">=</span> <span class="n">Tree</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">dmap_fset</span><span class="o">.</span><span class="n">cfgs</span><span class="p">,</span> <span class="n">dmap_fset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dmap_fset_nonhomo</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_sets</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fset_nonhomo_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">fset_nonhomo_map</span><span class="p">,</span> <span class="n">deduplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dmap_fset_nonhomo</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_fset_nonhomo</span> <span class="o">=</span> <span class="n">Tree</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">dmap_fset_nonhomo</span><span class="o">.</span><span class="n">cfgs</span><span class="p">,</span> <span class="n">dmap_fset_nonhomo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Factor sets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree_fset</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Factor sets (unfiltered)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree_fset_nonhomo</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>As we can see, our technique is able to distinguish formulas better than the filtered factor sets, but not better than unfiltered factor sets.</p>
<p>We can further analyze where unused possibilities of distinguishing remain but expanding the tree using the distinguishing map built out of factor sets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expanded</span> <span class="o">=</span> <span class="n">tree_remapped</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">dmap_fset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Zero hit + factor sets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expanded</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>The tree improves its distinguishing abilities, however, upon closer analysis, the polynomials that it uses to further split the configurations never actually have solutions on the curves with the assumed properties (e.g. <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0</span></code>).</p>
</section>
</section>
<section id="Miscellaneous-analysis">
<h2>Miscellaneous analysis<a class="headerlink" href="#Miscellaneous-analysis" title="Link to this heading">Â¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">PreOrderIter</span><span class="p">(</span><span class="n">expanded</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">dmap_input</span><span class="p">,</span> <span class="n">Poly</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">dmap_input</span><span class="p">,</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">cfgs</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">cfgs</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">dmap_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">formula</span><span class="p">,</span> <span class="n">fset</span> <span class="ow">in</span> <span class="n">factor_sets_nonhomo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">fset</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rev_point_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">params_cat</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">affine_params</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_points_filtered</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">poly_set</span> <span class="o">=</span> <span class="n">rev_point_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">((</span><span class="n">point</span><span class="p">,</span> <span class="n">affine_params</span><span class="p">),</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">poly_set</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">poly</span><span class="p">,</span> <span class="n">params_cat</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

<span class="k">for</span> <span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">affine_params</span><span class="p">),</span> <span class="n">poly_set</span> <span class="ow">in</span> <span class="n">rev_point_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;p=</span><span class="si">{</span><span class="n">affine_params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">prime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">polys_mapped</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">params_cat</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">poly_set</span><span class="p">:</span>
            <span class="n">mapd</span> <span class="o">=</span> <span class="n">eliminate_y</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="n">polys_mapped</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mapd</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">as_expr</span><span class="p">(),</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">params_cat</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="c1">#for formula, fset in factor_sets.items():</span>
            <span class="c1">#    if poly in fset and (cond in formula.coordinate_model.name or &quot;-&quot; not in formula.coordinate_model.name):</span>
            <span class="c1">#        print(&quot;\t&quot;, formula)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polys_mapped</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">ZZ</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">factor_list</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1">#poly_set, point)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">PreOrderIter</span><span class="p">(</span><span class="n">tree_remapped</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">dmap_input</span><span class="p">:</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="n">depth</span>
        <span class="n">poly_set</span> <span class="o">=</span> <span class="n">rev_point_map</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">dmap_input</span><span class="p">]</span>
        <span class="n">point</span><span class="p">,</span> <span class="n">affine_params</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">dmap_input</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;p=</span><span class="si">{</span><span class="n">affine_params</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">prime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="n">chain_map</span><span class="p">[</span><span class="n">affine_params</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">chain</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">affine_params</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">true_formulas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">params_cat</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">poly_set</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">as_expr</span><span class="p">(),</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">params_cat</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">formula</span><span class="p">,</span> <span class="n">fset</span> <span class="ow">in</span> <span class="n">factor_sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">fset</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cond</span> <span class="ow">in</span> <span class="n">formula</span><span class="o">.</span><span class="n">coordinate_model</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formula</span><span class="o">.</span><span class="n">coordinate_model</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                    <span class="n">kvar</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="k">if</span> <span class="n">formula</span><span class="o">.</span><span class="n">shortname</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;dbl&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="n">kvar</span> <span class="ow">in</span> <span class="n">chain</span> <span class="k">else</span> <span class="s2">&quot;not&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">kvar</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
                        <span class="n">true_formulas</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">cfgs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">response</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span> <span class="k">if</span> <span class="n">true_formulas</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;nok&quot;</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">response</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">true_formulas</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;nok&quot;</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">coord_name</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">coord_name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">formula_group</span><span class="p">,</span> <span class="n">formula_class</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">formula_groups</span><span class="p">[</span><span class="n">coords</span><span class="p">],</span> <span class="n">formula_classes</span><span class="p">):</span>
        <span class="n">lf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">formula_group</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">formula_class</span><span class="o">.</span><span class="n">shortname</span><span class="p">,</span> <span class="n">lf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">formula_group</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">formula</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">*=</span> <span class="n">lf</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="p">(</span><span class="n">tree_remapped</span><span class="p">,</span> <span class="n">tree_count</span><span class="p">,</span> <span class="n">tree_position</span><span class="p">):</span>
    <span class="n">same</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">:</span>
        <span class="n">cds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">leaf</span><span class="o">.</span><span class="n">cfgs</span><span class="p">:</span>
            <span class="n">cds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate_model</span><span class="p">)</span>
            <span class="n">cds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate_model</span><span class="p">)</span>
        <span class="n">same</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">same</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">LevelOrderIter</span><span class="p">(</span><span class="n">tree_count</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">tree_counter</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">response</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">)))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">tree_counter</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">tree_counter</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dmap_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dmap_count</span><span class="o">.</span><span class="n">mapping</span><span class="p">:</span>
    <span class="n">dmap_counter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dmap_count</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

<span class="k">del</span> <span class="n">dmap_counter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">del</span> <span class="n">dmap_counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dmap_counter</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">dmap_counter</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2018-2024, Jan Jancar.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.5</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/notebook/re/zvp.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>